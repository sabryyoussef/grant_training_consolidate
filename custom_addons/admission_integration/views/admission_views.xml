<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Extend Admission Tree View -->
    <record id="view_op_admission_tree_inherit" model="ir.ui.view">
        <field name="name">op.admission.list.inherit</field>
        <field name="model">op.admission</field>
        <field name="inherit_id" ref="openeducat_admission.view_op_admission_tree"/>
        <field name="arch" type="xml">
            <field name="state" position="after">
                <field name="source_type" optional="show"/>
                <field name="is_imported" optional="hide"/>
            </field>
        </field>
    </record>
    
    <!-- Extend Admission Form View -->
    <record id="view_op_admission_form_inherit" model="ir.ui.view">
        <field name="name">op.admission.form.inherit</field>
        <field name="model">op.admission</field>
        <field name="inherit_id" ref="openeducat_admission.view_op_admission_form"/>
        <field name="arch" type="xml">
            <!-- Add Source Information Section -->
            <xpath expr="//sheet" position="inside">
                <group string="Source Information" invisible="source_type == 'manual'" class="mt-3">
                    <group>
                        <field name="source_type" readonly="1"/>
                        <field name="is_imported" readonly="1"/>
                    </group>
                    <group>
                        <field name="source_registration_id" readonly="1" 
                               invisible="source_type != 'student_registration'"
                               options="{'no_create': True, 'no_create_edit': True}"/>
                        <field name="source_batch_intake_id" readonly="1" 
                               invisible="source_type != 'batch_intake'"
                               options="{'no_create': True, 'no_create_edit': True}"/>
                        <field name="source_contact_pool_id" readonly="1" 
                               invisible="source_type != 'contact_pool'"
                               options="{'no_create': True, 'no_create_edit': True}"/>
                        <field name="source_contact_id" readonly="1" 
                               invisible="source_type != 'contact_pool'"
                               options="{'no_create': True, 'no_create_edit': True}"/>
                    </group>
                </group>
            </xpath>
            <!-- Add button to open source record in header -->
            <xpath expr="//header" position="inside">
                <button name="action_open_source_record" 
                        string="View Source" 
                        type="object" 
                        class="btn-secondary"
                        invisible="source_type == 'manual' or not source_type"
                        groups="openeducat_core.group_op_back_office_admin,openeducat_core.group_op_faculty"/>
            </xpath>
        </field>
    </record>
    
    <!-- Add Filters to Admission Search View -->
    <record id="view_op_admission_search_inherit" model="ir.ui.view">
        <field name="name">op.admission.search.inherit</field>
        <field name="model">op.admission</field>
        <field name="inherit_id" ref="openeducat_admission.view_op_admission_search"/>
        <field name="arch" type="xml">
            <filter name="enrolled_student" position="after">
                <separator/>
                <filter string="From Registration Portal" name="filter_source_registration" 
                        domain="[('source_type', '=', 'student_registration')]"/>
                <filter string="From Batch Intake" name="filter_source_batch_intake" 
                        domain="[('source_type', '=', 'batch_intake')]"/>
                <filter string="From Contact Pool" name="filter_source_contact_pool" 
                        domain="[('source_type', '=', 'contact_pool')]"/>
                <filter string="Imported" name="filter_imported" 
                        domain="[('is_imported', '=', True)]"/>
                <filter string="Manual Entry" name="filter_manual" 
                        domain="[('source_type', '=', 'manual')]"/>
            </filter>
            <group position="inside">
                <filter string="Source Type" name="group_by_source_type" 
                        domain="[]" context="{'group_by': 'source_type'}"/>
            </group>
        </field>
    </record>
    
</odoo>

